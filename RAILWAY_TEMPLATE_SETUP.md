# Creating a Railway One-Click Deploy Template

This guide explains how to create a Railway template for the Martinis application, enabling a one-click deploy button.

## Overview

Railway templates allow users to deploy your application with a single click. As of 2025, Railway templates are created through the Railway dashboard UI, not through configuration files.

## Prerequisites

- A deployed Railway project with your application
- The project must be linked to a **public GitHub repository**
- Both the application and MySQL database should be configured and working

## Step 1: Deploy and Configure Your Project

1. **Deploy Martinis to Railway** (if not already deployed)
   - Create a new Railway project
   - Deploy from the `martinisapp/martinis` GitHub repository
   - Add MySQL database service
   - Configure all environment variables
   - Verify the application works correctly

2. **Test Your Deployment**
   - Ensure the app starts successfully
   - Verify database connection
   - Test admin login
   - Check all features work as expected

## Step 2: Convert Project to Template

1. **Access Project Settings**
   - Go to your Railway project dashboard
   - Click on the project settings (gear icon)

2. **Create Template**
   - Look for "Convert to Template" or "Publish as Template" option
   - Click to convert your project to a template

3. **Configure Template Settings**
   - **Name**: "Martinis - Screenplay Management"
   - **Description**: "Professional screenplay management application built with Spring Boot 3.2.0 and MySQL"
   - **Category**: Select appropriate category (e.g., "Web Apps" or "Full Stack")
   - **Keywords**: Add relevant keywords: `java`, `spring-boot`, `mysql`, `screenplay`, `film-production`
   - **Logo/Icon**: Optional - add a logo if available

4. **Configure Template Variables**
   Railway will automatically detect environment variables from your project. Ensure these are configured:

   - `DATABASE_URL` - Automatically generated by MySQL service
   - `ADMIN_USERNAME` - Default: "admin"
   - `ADMIN_PASSWORD` - User should set this (mark as required or generate)
   - `ADMIN_FIRSTNAME` - Default: "System"
   - `ADMIN_LASTNAME` - Default: "Administrator"
   - `PORT` - Automatically set by Railway

5. **Set Variable Defaults and Descriptions**
   - Add helpful descriptions for each variable
   - Set sensible defaults where appropriate
   - Mark `ADMIN_PASSWORD` as required or set to auto-generate

## Step 3: Get Your Template Code

1. **Publish Template**
   - Click "Publish Template" or "Create Template"
   - Railway will generate a unique template code

2. **Get Template URL**
   - Your template URL will be in the format:
     ```
     https://railway.com/new/template/YOUR-TEMPLATE-CODE
     ```
   - Example: `https://railway.com/new/template/ZweBXA`

3. **Copy Template Code**
   - Note down your template code (e.g., `ZweBXA`)

## Step 4: Update Repository

Once you have your template code, update the following files:

### 1. README.md

Replace the placeholder deploy button:

```markdown
## Quick Deploy to Railway

[![Deploy on Railway](https://railway.com/button.svg)](https://railway.com/new/template/YOUR-TEMPLATE-CODE)

Click the button above to deploy to Railway with MySQL automatically configured.
```

### 2. RAILWAY.md

Update the quick start section:

```markdown
### One-Click Deploy

[![Deploy on Railway](https://railway.com/button.svg)](https://railway.com/new/template/YOUR-TEMPLATE-CODE)
```

### 3. RAILWAY_MYSQL_SETUP.md

Update the deploy button section:

```markdown
## Fastest Method: Deploy to Railway Button

[![Deploy on Railway](https://railway.com/button.svg)](https://railway.com/new/template/YOUR-TEMPLATE-CODE)

When you click this button, Railway automatically creates both the application and MySQL database.
```

## Step 5: Test the Template

1. **Test in Incognito/Private Window**
   - Open your template URL in an incognito/private browser window
   - Click through the deployment process
   - Verify all services are created correctly
   - Check that environment variables are set properly

2. **Verify Deployment**
   - Ensure the application deploys successfully
   - Test database connectivity
   - Verify admin login works
   - Check that the database schema initializes correctly

## Troubleshooting

### Template Not Creating Multiple Services

**Issue**: Template only creates the application, not MySQL.

**Solution**:
- Ensure your original project has both services (app + MySQL)
- Both services must be properly configured before converting to template
- Railway should automatically include all services from the source project

### Variables Not Set Correctly

**Issue**: Environment variables are missing or incorrect after deployment.

**Solution**:
- Check template configuration in Railway dashboard
- Edit the template to add missing variables
- Ensure variable descriptions are clear
- Set appropriate defaults

### Database Connection Fails

**Issue**: Application can't connect to MySQL after template deployment.

**Solution**:
- Verify `DATABASE_URL` is automatically generated
- Check that both services are in the same project
- Ensure the connection string format is correct
- Railway automatically connects services via private network

## Template Best Practices

1. **Clear Documentation**
   - Provide clear instructions in template description
   - Document all required environment variables
   - Include post-deployment steps

2. **Sensible Defaults**
   - Set reasonable default values
   - Use auto-generation for passwords
   - Pre-configure common settings

3. **Health Checks**
   - Ensure your `railway.json` includes health check configuration
   - Set appropriate timeouts and retry policies

4. **Testing**
   - Test the template deployment multiple times
   - Try deploying from different accounts
   - Verify all features work in template-deployed instances

## Maintaining Your Template

1. **Update Template**
   - When you update your source repository, Railway templates may need to be updated
   - Check Railway dashboard for template update options
   - Test template after significant code changes

2. **Monitor Usage**
   - Railway provides analytics for template deployments
   - Check for common issues users face
   - Update documentation based on feedback

## Additional Resources

- [Railway Templates Documentation](https://docs.railway.com/guides/templates)
- [Railway Template Publishing Guide](https://docs.railway.com/guides/publish-and-share)
- [Railway Config as Code](https://docs.railway.com/reference/config-as-code)
- [Railway Community Templates](https://github.com/railwayapp/templates)

## Current Status

**Template Status**: Not yet created

**Deploy Method**: Currently using GitHub repository deployment (see README.md)

**Next Steps**:
1. Follow this guide to create a Railway template
2. Get your template code
3. Update README.md, RAILWAY.md, and RAILWAY_MYSQL_SETUP.md with the template code
4. Remove placeholder comments
5. Test the one-click deploy button

---

**Note**: Railway's template system is managed through their web dashboard. Configuration files like `railway.toml` are for service-level settings, not for defining templates. Always create templates through the Railway UI.
